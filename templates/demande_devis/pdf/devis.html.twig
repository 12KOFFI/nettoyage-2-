<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Devis {{ devis.numeroDevis }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        @page { margin: 25px 25px 80px; }
        body { 
            font-family: Helvetica, Arial, sans-serif; 
            font-size: 12px; 
            line-height: 1.5; 
            color: #333; 
        }
        .container { 
            padding: 30px; 
            padding-bottom: 90px; 
        }
        
        /* Header */
        .header { 
            width: 100%; 
            margin-bottom: 25px; 
            border-bottom: 3px solid #003366; 
            padding-bottom: 15px; 
        }
        .header-table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        .header-table td { 
            width: 50%; 
            vertical-align: top; 
        }
        .header-right { 
            text-align: right; 
        }
        .logo { 
            max-width: 180px; 
            max-height: 70px; 
            margin-bottom: 8px; 
        }
        .company-name { 
            font-size: 18px; 
            font-weight: bold; 
            color: #003366; 
        }
        .company-info { 
            font-size: 10px; 
            color: #666; 
        }
        .devis-title { 
            font-size: 24px; 
            font-weight: bold; 
            color: #003366; 
        }
        .devis-number { 
            font-size: 13px; 
            color: #333; 
            margin-top: 5px; 
        }
        
        /* Sections */
        .section { 
            margin-bottom: 20px; 
        }
        .section-title { 
            font-size: 14px; 
            font-weight: bold; 
            color: #003366; 
            border-bottom: 2px solid #7CB342; 
            padding-bottom: 5px; 
            margin-bottom: 10px; 
        }
        
        /* Tables d'informations */
        .info-table { 
            width: 100%; 
        }
        .info-table td { 
            padding: 4px 0; 
            vertical-align: top; 
        }
        .info-label { 
            font-weight: bold; 
            color: #555; 
            width: 40%; 
        }
        .info-value { 
            color: #333; 
        }
        
        /* Table des prestations */
        .prestations-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px; 
        }
        .prestations-table th,
        .prestations-table .prestations-header td { 
            background: #003366; 
            color: #fff; 
            padding: 10px; 
            text-align: left; 
            font-size: 11px; 
            font-weight: bold; 
        }
        .prestations-table td { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            font-size: 11px; 
        }
        .prestations-table tr:nth-child(even) { 
            background: #f9f9f9; 
        }
        .prestation-personnalisee { 
            background: #e8f5e9; 
        }
        
        /* Totaux */
        .totaux { 
            margin-top: 20px; 
            width: 50%; 
            margin-left: auto; 
        }
        .totaux-table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        .totaux-table td { 
            padding: 8px 10px; 
        }
        .label { 
            text-align: right; 
            font-weight: bold; 
            color: #555; 
        }
        .value { 
            text-align: right; 
        }
        .total-row { 
            background: #003366; 
            color: #fff; 
            font-size: 14px; 
        }
        .total-row td { 
            padding: 10px; 
        }
        .border-top { 
            border-top: 1px solid #ddd; 
        }
        
        /* Conditions */
        .conditions { 
            margin-top: 30px; 
            padding: 15px; 
            background: #f5f5f5; 
        }
        .conditions-title { 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: #003366; 
        }
        .conditions-text { 
            font-size: 10px; 
            color: #666; 
        }
        
        /* Signature */
        .signature { 
            margin-top: 40px; 
        }
        .signature-table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        .signature-box { 
            width: 48%; 
            padding: 15px; 
            border: 1px solid #ddd; 
            vertical-align: top; 
        }
        .signature-spacer { 
            width: 4%; 
        }
        .signature-title { 
            font-weight: bold; 
            margin-bottom: 5px; 
            font-size: 11px; 
        }
        .signature-line { 
            border-bottom: 1px solid #333; 
            height: 60px; 
            margin-top: 10px; 
        }
        
        /* Footer */
        .footer { 
            position: fixed; 
            bottom: 20px; 
            left: 25px; 
            right: 25px; 
            text-align: center; 
            font-size: 9px; 
            color: #999; 
            border-top: 1px solid #ddd; 
            padding-top: 10px; 
        }
        
        /* Détails spécifiques */
        .details-box { 
            margin-top: 10px; 
            padding: 8px 10px; 
            background: #f5f5f5; 
            border-left: 3px solid #7CB342; 
            font-size: 11px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <table class="header-table">
                <tr>
                    <td class="header-left">
                        {% if logoBase64 is defined and logoBase64 %}
                            <img src="{{ logoBase64 }}" alt="Logo" class="logo">
                        {% endif %}
                        <div class="company-name">Multi-Nettoyage Propreté Plus 94</div>
                        <div class="company-info">
                            Services de nettoyage professionnel<br>
                            Paris et Île-de-France<br>
                            Tél. : 06.69.53.75.73<br>
                            Email : multinettoyage94@gmail.com
                        </div>
                    </td>
                    <td class="header-right">
                        <div class="devis-title">DEVIS</div>
                        <div class="devis-number">
                            <strong>N° {{ devis.numeroDevis }}</strong><br>
                            Date : {{ dateGeneration|date('d/m/Y') }}<br>
                            Validité : 30 jours
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Client -->
        <div class="section">
            <div class="section-title">INFORMATIONS CLIENT</div>
            <table class="info-table">
                {% if client %}
                <tr>
                    <td class="info-label">Nom :</td>
                    <td class="info-value">{{ client.nom }} {{ client.prenom }}</td>
                </tr>
                <tr>
                    <td class="info-label">Email :</td>
                    <td class="info-value">{{ client.email }}</td>
                </tr>
                <tr>
                    <td class="info-label">Téléphone :</td>
                    <td class="info-value">{{ client.telephone }}</td>
                </tr>
                {% else %}
                <tr><td colspan="2">Informations client non disponibles</td></tr>
                {% endif %}
            </table>
        </div>

        <!-- Lieu d'intervention -->
        <div class="section">
            <div class="section-title">LIEU D'INTERVENTION</div>
            <table class="info-table">
                {% if local %}
                <tr>
                    <td class="info-label">Type de local :</td>
                    <td class="info-value">{{ local.typeLocal }}</td>
                </tr>
                <tr>
                    <td class="info-label">Adresse :</td>
                    <td class="info-value">{{ local.ville }}</td>
                </tr>
                <tr>
                    <td class="info-label">Surface :</td>
                    <td class="info-value">{{ local.surfaceM2 }} m²</td>
                </tr>
                {% else %}
                <tr><td colspan="2">Informations local non disponibles</td></tr>
                {% endif %}
            </table>
        </div>

        <!-- Détails prestation -->
        <div class="section">
            <div class="section-title">DÉTAILS DE LA PRESTATION</div>
            <table class="info-table">
                <tr>
                    <td class="info-label">Fréquence :</td>
                    <td class="info-value">{{ devis.frequence }}</td>
                </tr>
                <tr>
                    <td class="info-label">Créneau horaire :</td>
                    <td class="info-value">{{ devis.creneauHoraire }}</td>
                </tr>
            </table>
            
            {% if prestations|length > 0 %}
            <table class="prestations-table">
                <tbody>
                    <tr class="prestations-header">
                        <td style="width: 40%;">Prestation</td>
                        <td style="width: 60%;">Description</td>
                    </tr>
                    {% set detailsSpecifiques = null %}
                    {% for dp in prestations %}
                        {% if dp.detailsSpecifiques and detailsSpecifiques is null %}
                            {% set detailsSpecifiques = dp.detailsSpecifiques %}
                        {% endif %}
                        <tr{% if not dp.prestation %} class="prestation-personnalisee"{% endif %}>
                            <td>
                                {% if dp.prestation and dp.prestation.libelle != 'Autre (Personnalisée)' %}
                                    {{ dp.prestation.libelle }}
                                {% else %}
                                    Autre (Personnalisée)
                                {% endif %}
                            </td>
                            <td>{{ dp.adminDescription|default('—') }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            {% if detailsSpecifiques is defined and detailsSpecifiques %}
            <div class="details-box">
                <strong>Détails spécifiques :</strong> {{ detailsSpecifiques }}
            </div>
            {% endif %}
        </div>

        <!-- Prix -->
        {% if prix %}
        <div class="totaux">
            <table class="totaux-table">
                <tr>
                    <td class="label">Prix unitaire HT :</td>
                    <td class="value">{{ prix.montantHt|number_format(2, ',', ' ') }} €/m²</td>
                </tr>
                <tr>
                    <td class="label">Surface :</td>
                    <td class="value">{{ local ? local.surfaceM2 : 1 }} m²</td>
                </tr>
                <tr class="border-top">
                    <td class="label">Montant HT total :</td>
                    <td class="value">{{ prix.montantHtTotal|number_format(2, ',', ' ') }} €</td>
                </tr>
                {% if prix.remise and prix.remise > 0 %}
                <tr>
                    <td class="label">Remise :</td>
                    <td class="value">- {{ prix.remise|number_format(2, ',', ' ') }} €</td>
                </tr>
                <tr>
                    <td class="label">Sous-total HT :</td>
                    <td class="value">{{ prix.montantHtApresRemise|number_format(2, ',', ' ') }} €</td>
                </tr>
                {% endif %}
                <tr>
                    <td class="label">TVA ({{ prix.tva }}%) :</td>
                    <td class="value">{{ prix.montantTva|number_format(2, ',', ' ') }} €</td>
                </tr>
                <tr class="total-row">
                    <td class="label">TOTAL TTC :</td>
                    <td class="value"><strong>{{ prix.totalTtc|number_format(2, ',', ' ') }} €</strong></td>
                </tr>
            </table>
        </div>
        {% endif %}

        <!-- Conditions -->
        <div class="conditions">
            <div class="conditions-title">CONDITIONS GÉNÉRALES</div>
            <div class="conditions-text">
                <strong>Validité :</strong> Ce devis est valable 30 jours à compter de sa date d'émission.<br>
                <strong>Règlement :</strong> 30% à la commande, solde à réception de facture.<br>
                <strong>Délai d'intervention :</strong> Sous 7 jours ouvrés après acceptation du devis.<br>
                <strong>Annulation :</strong> Toute annulation doit être notifiée 48h avant l'intervention prévue.<br>
                <strong>Garantie :</strong> Nos prestations sont garanties satisfait ou refait sous 24h.
            </div>
        </div>

        <!-- Signature -->
        <div class="signature">
            <table class="signature-table">
                <tr>
                    <td class="signature-box">
                        <div class="signature-title">BON POUR ACCORD</div>
                        <div>Date : _______________</div>
                        <div class="signature-line"></div>
                        <div style="font-size: 10px; color: #666; margin-top: 5px;">Signature du client précédée de la mention "Lu et approuvé"</div>
                    </td>
                    <td class="signature-spacer"></td>
                    <td class="signature-box">
                        <div class="signature-title">POUR LA SOCIÉTÉ</div>
                        <div>Multi-Nettoyage Propreté Plus 94</div>
                        <div class="signature-line"></div>
                        <div style="font-size: 10px; color: #666; margin-top: 5px;">Cachet et signature</div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Footer -->
        <div class="footer">
            Multi-Nettoyage Propreté Plus 94<br>
            Tél. : 06.69.53.75.73 - Email : multinettoyage94@gmail.com<br>
            SIRET : RCS CRÉTEIL 990 875 155 00014 - Code APE : 8122Z - TVA intercommunautaire : FR 46990875155
        </div>
    </div>
</body>
</html>